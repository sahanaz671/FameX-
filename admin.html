<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FameX | GOD MODE</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- SCI-FI GOD MODE THEME --- */
        :root {
            --bg-deep: #020205;
            --panel-bg: rgba(10, 15, 20, 0.7);
            --neon-blue: #00f3ff;
            --neon-red: #ff0055;
            --neon-green: #00ff9d;
            --neon-gold: #ffcc00;
            --glass-border: 1px solid rgba(0, 243, 255, 0.1);
        }

        body {
            font-family: 'Segoe UI', 'Roboto', monospace;
            background-color: var(--bg-deep);
            background-image: 
                linear-gradient(rgba(0, 243, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 243, 255, 0.03) 1px, transparent 1px);
            background-size: 30px 30px;
            color: #fff;
            margin: 0; padding: 20px;
            overflow-x: hidden;
        }

        /* HEADER */
        .god-header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 20px;
            background: rgba(0,0,0,0.8);
            border-bottom: 2px solid var(--neon-blue);
            box-shadow: 0 0 20px var(--neon-blue);
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }
        .logo { font-size: 2rem; font-weight: 900; letter-spacing: 4px; color: #fff; text-shadow: 0 0 10px var(--neon-blue); }
        .logo span { color: var(--neon-blue); }

        /* KPI CARDS */
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .kpi-card {
            background: linear-gradient(135deg, rgba(0,243,255,0.05), rgba(0,0,0,0.8));
            border: 1px solid var(--neon-blue);
            padding: 20px;
            border-radius: 5px;
            position: relative;
            overflow: hidden;
        }
        .kpi-card::before { content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%; background: var(--neon-blue); box-shadow: 0 0 15px var(--neon-blue); }
        .kpi-val { font-size: 2.5rem; font-weight: bold; margin: 10px 0; text-shadow: 0 0 10px var(--neon-blue); }
        .kpi-label { color: #888; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 2px; }

        /* TABS */
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .tab-btn {
            background: transparent; border: 1px solid #333; color: #666;
            padding: 10px 30px; cursor: pointer; font-family: monospace;
            transition: 0.3s; text-transform: uppercase; letter-spacing: 2px;
        }
        .tab-btn:hover, .tab-btn.active {
            background: rgba(0, 243, 255, 0.1);
            border-color: var(--neon-blue);
            color: var(--neon-blue);
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.3);
            text-shadow: 0 0 5px var(--neon-blue);
        }

        /* SECTIONS */
        .section { display: none; animation: fadeIn 0.4s; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* TABLE */
        .cyber-table { width: 100%; border-collapse: collapse; background: rgba(0,0,0,0.5); }
        .cyber-table th { 
            text-align: left; padding: 15px; 
            color: var(--neon-blue); border-bottom: 1px solid var(--neon-blue); 
            font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px;
        }
        .cyber-table td { padding: 15px; border-bottom: 1px solid #222; font-size: 0.9rem; color: #ddd; vertical-align: middle; }
        .cyber-table tr:hover { background: rgba(0, 243, 255, 0.05); }

        /* BUTTONS */
        .btn-neon {
            background: transparent; border: 1px solid var(--neon-blue); color: var(--neon-blue);
            padding: 5px 15px; cursor: pointer; text-transform: uppercase; font-size: 0.7rem; font-weight: bold;
            transition: 0.3s; box-shadow: 0 0 5px var(--neon-blue);
        }
        .btn-neon:hover { background: var(--neon-blue); color: #000; box-shadow: 0 0 20px var(--neon-blue); }
        
        .btn-danger { border-color: var(--neon-red); color: var(--neon-red); box-shadow: 0 0 5px var(--neon-red); }
        .btn-danger:hover { background: var(--neon-red); color: #fff; box-shadow: 0 0 20px var(--neon-red); }
        
        .btn-success { border-color: var(--neon-green); color: var(--neon-green); box-shadow: 0 0 5px var(--neon-green); }
        .btn-success:hover { background: var(--neon-green); color: #000; box-shadow: 0 0 20px var(--neon-green); }

        /* LOGIN */
        .login-gate {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999; display: flex; justify-content: center; align-items: center;
        }
        .login-box {
            border: 2px solid var(--neon-blue); padding: 50px; text-align: center;
            box-shadow: 0 0 50px var(--neon-blue); background: rgba(0,0,0,0.9);
        }

        /* INPUTS */
        input, select {
            background: #111; border: 1px solid #333; color: var(--neon-blue);
            padding: 8px; outline: none; font-family: monospace;
        }
        input:focus { border-color: var(--neon-blue); }

        .status-pill { padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; border: 1px solid #555; }
    </style>
</head>
<body>

    <div id="login-screen" class="login-gate">
        <div class="login-box">
            <h1 class="logo">Fame<span>X</span> /// GOD MODE</h1>
            <p style="color:var(--neon-blue); letter-spacing:2px; margin-bottom:30px;">SECURE CONNECTION REQUIRED</p>
            <button class="btn-neon" id="adminLoginBtn" style="padding:15px 30px; font-size:1rem;">Authenticate</button>
        </div>
    </div>

    <div id="dashboard" style="display:none;">
        
        <div class="god-header">
            <div class="logo">Fame<span>X</span> <span style="font-size:1rem; color:#666; margin-left:10px;">// SYSTEM CONTROL</span></div>
            <button class="btn-danger" id="adminLogoutBtn">Terminate Session</button>
        </div>

        <div class="kpi-grid">
            <div class="kpi-card">
                <div class="kpi-label">Total Users</div>
                <div class="kpi-val" id="totalUsers">0</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Pending Orders</div>
                <div class="kpi-val" id="pendingOrders" style="color:var(--neon-gold);">0</div>
            </div>
            <div class="kpi-card">
                <div class="kpi-label">Verification Queue</div>
                <div class="kpi-val" id="pendingPayments" style="color:var(--neon-green);">0</div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="showTab('users')">Users DB</button>
            <button class="tab-btn" onclick="showTab('orders')">Live Orders</button>
            <button class="tab-btn" onclick="showTab('payments')">Bank Ops</button>
        </div>

        <div id="users" class="section active">
            <div style="margin-bottom:15px; display:flex; justify-content:space-between;">
                <h2 style="color:var(--neon-blue); margin:0;">USER DATABASE</h2>
                <button class="btn-neon" onclick="loadUsers()">Refresh Data</button>
            </div>
            <table class="cyber-table">
                <thead>
                    <tr>
                        <th>Identity</th>
                        <th>Wallet</th>
                        <th>Stats (Spent/Orders)</th>
                        <th>Referral</th>
                        <th>God Actions</th>
                    </tr>
                </thead>
                <tbody id="user-table-body"></tbody>
            </table>
        </div>

        <div id="orders" class="section">
            <h2 style="color:var(--neon-gold);">LIVE ORDERS FEED</h2>
            <table class="cyber-table">
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>User</th>
                        <th>Service Target</th>
                        <th>Cost</th>
                        <th>Status</th>
                        <th>Override</th>
                    </tr>
                </thead>
                <tbody id="orders-table-body"></tbody>
            </table>
        </div>

        <div id="payments" class="section">
            <h2 style="color:var(--neon-green);">FINANCIAL REQUESTS</h2>
            <table class="cyber-table">
                <thead>
                    <tr>
                        <th>User</th>
                        <th>Transaction Detail</th>
                        <th>Status</th>
                        <th>Execute</th>
                    </tr>
                </thead>
                <tbody id="payment-table-body"></tbody>
            </table>
        </div>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getFirestore, collection, getDocs, getDoc, doc, updateDoc, deleteDoc, onSnapshot, query, orderBy, increment, where } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        // CONFIG (MUST MATCH YOUR USER SITE)
        const firebaseConfig = {
            apiKey: "AIzaSyAN_hd8rr46X25lOZ0cKwe6pAVl2sh61AI",
            authDomain: "famex-4cb1e.firebaseapp.com",
            projectId: "famex-4cb1e",
            storageBucket: "famex-4cb1e.firebasestorage.app",
            messagingSenderId: "395925089964",
            appId: "1:395925089964:web:551ef2089aa25d09743909",
            measurementId: "G-S1T0L618XL"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        // ⚠️ ADMIN EMAIL CONFIGURATION ⚠️
        const ADMIN_EMAIL = "yoursa.in.here@gmail.com"; 

        // AUTH LOGIC
        onAuthStateChanged(auth, (user) => {
            if (user && user.email.toLowerCase() === ADMIN_EMAIL.toLowerCase()) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                initDashboard();
            } else if (user) {
                alert("UNAUTHORIZED ENTITY DETECTED.");
                signOut(auth);
            }
        });

        document.getElementById('adminLoginBtn').addEventListener('click', () => {
            signInWithPopup(auth, provider).catch(e => alert(e.message));
        });
        document.getElementById('adminLogoutBtn').addEventListener('click', () => {
            signOut(auth).then(() => window.location.reload());
        });

        // --- DASHBOARD FUNCTIONS ---
        function initDashboard() {
            loadUsers();
            loadOrders();
            loadPayments();
            loadStats();
        }

        window.showTab = (tabId) => {
            document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
        }

        // --- 1. USER MANAGEMENT (GOD LEVEL) ---
        window.loadUsers = async () => {
            const tbody = document.getElementById('user-table-body');
            tbody.innerHTML = '<tr><td colspan="5">Scanning Database...</td></tr>';
            
            const q = query(collection(db, "users"), orderBy("balance", "desc"));
            const snapshot = await getDocs(q);
            
            tbody.innerHTML = '';
            document.getElementById('totalUsers').innerText = snapshot.size;

            snapshot.forEach(docSnap => {
                const user = docSnap.data();
                const uid = docSnap.id;
                const isBanned = user.forceLogout === true;

                const row = `
                    <tr style="${isBanned ? 'opacity:0.5; background:rgba(255,0,0,0.1);' : ''}">
                        <td>
                            <div style="font-weight:bold; color:#fff;">${user.name}</div>
                            <div style="font-size:0.75rem; color:#666;">${user.email}</div>
                            ${isBanned ? '<span style="color:red; font-weight:bold;">[BANNED]</span>' : ''}
                        </td>
                        <td>
                            <div style="color:var(--neon-gold); font-size:1.1rem;">₹${user.balance || 0}</div>
                            <input type="number" id="bal-${uid}" placeholder="Set" style="width:60px; font-size:0.7rem;">
                            <button class="btn-neon" onclick="updateBal('${uid}')">Save</button>
                        </td>
                        <td>
                            <div>Spent: <span style="color:var(--neon-blue);">₹${user.totalSpent || 0}</span></div>
                            <div>Orders: <span style="color:var(--neon-blue);">${user.totalOrders || 0}</span></div>
                        </td>
                        <td>
                            <div>Code: <strong style="color:var(--neon-green);">${user.referralCode || 'N/A'}</strong></div>
                            <div>Earnings: ₹${user.referralEarnings || 0}</div>
                        </td>
                        <td>
                            ${isBanned 
                                ? `<button class="btn-success" onclick="toggleBan('${uid}', false)">UNBAN</button>`
                                : `<button class="btn-danger" onclick="toggleBan('${uid}', true)">BAN</button>`
                            }
                        </td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        window.updateBal = async (uid) => {
            const val = document.getElementById(`bal-${uid}`).value;
            if(val === '') return;
            await updateDoc(doc(db, "users", uid), { balance: parseFloat(val) });
            alert("Balance Forced Update Complete.");
            loadUsers();
        }

        window.toggleBan = async (uid, status) => {
            if(!confirm(status ? "BAN USER?" : "RESTORE USER?")) return;
            await updateDoc(doc(db, "users", uid), { forceLogout: status });
            loadUsers();
        }

        // --- 2. LIVE ORDERS ---
        window.loadOrders = () => {
            const tbody = document.getElementById('orders-table-body');
            const q = query(collection(db, "orders"), orderBy("timestamp", "desc"));
            
            onSnapshot(q, (snap) => {
                tbody.innerHTML = '';
                let pendingCount = 0;
                
                snap.forEach(docSnap => {
                    const order = docSnap.data();
                    const oid = docSnap.id;
                    if(order.status === 'Pending') pendingCount++;

                    // Format Time
                    const date = order.timestamp ? order.timestamp.toDate().toLocaleString() : 'N/A';
                    
                    // Status Color
                    let sColor = '#888';
                    if(order.status === 'Pending') sColor = 'var(--neon-gold)';
                    if(order.status === 'Processing') sColor = 'var(--neon-blue)';
                    if(order.status === 'Completed') sColor = 'var(--neon-green)';
                    if(order.status === 'Cancelled') sColor = 'var(--neon-red)';

                    const row = `
                        <tr>
                            <td style="font-size:0.75rem; color:#666;">${date}</td>
                            <td>
                                <div>${order.userName}</div>
                                <div style="font-size:0.7rem;">${order.userEmail}</div>
                            </td>
                            <td>
                                <div style="color:var(--neon-blue);">${order.service}</div>
                                <a href="${order.link}" target="_blank" style="color:#666; font-size:0.7rem;">${order.link.substring(0,25)}...</a>
                                <div style="font-size:0.7rem;">Qty: ${order.quantity}</div>
                            </td>
                            <td style="color:var(--neon-gold);">₹${order.cost}</td>
                            <td><span class="status-pill" style="color:${sColor}; border-color:${sColor};">${order.status}</span></td>
                            <td>
                                <select onchange="setStatus('${oid}', this.value)" style="padding:2px; font-size:0.8rem;">
                                    <option>Actions...</option>
                                    <option value="Processing">Processing</option>
                                    <option value="Completed">Completed</option>
                                    <option value="Cancelled">Cancelled</option>
                                </select>
                            </td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                });
                document.getElementById('pendingOrders').innerText = pendingCount;
            });
        }

        window.setStatus = async (oid, status) => {
            if(status === 'Actions...') return;
            await updateDoc(doc(db, "orders", oid), { status: status });
        }

        // --- 3. PAYMENTS (BANK OPS) ---
        window.loadPayments = () => {
            const tbody = document.getElementById('payment-table-body');
            const q = query(collection(db, "payment_verifications"), orderBy("timestamp", "desc"));
            
            onSnapshot(q, (snap) => {
                tbody.innerHTML = '';
                let pendingCount = 0;

                snap.forEach(docSnap => {
                    const pay = docSnap.data();
                    const pid = docSnap.id;
                    if(pay.status === 'Checking') pendingCount++;

                    let sColor = '#888';
                    if(pay.status === 'Checking') sColor = 'var(--neon-gold)';
                    if(pay.status === 'Success') sColor = 'var(--neon-green)';
                    if(pay.status === 'Rejected') sColor = 'var(--neon-red)';

                    const row = `
                        <tr>
                            <td>
                                <div>${pay.userName}</div>
                                <div style="font-size:0.7rem;">${pay.userEmail}</div>
                            </td>
                            <td>
                                <div style="color:var(--neon-gold); font-weight:bold; font-size:1.1rem;">₹${pay.amount}</div>
                                <div>UTR: <span style="color:#fff;">${pay.utr}</span></div>
                                <div style="font-size:0.7rem;">Sender: ${pay.senderName}</div>
                            </td>
                            <td><span class="status-pill" style="color:${sColor}; border-color:${sColor};">${pay.status}</span></td>
                            <td>
                                ${pay.status === 'Checking' ? `
                                    <button class="btn-success" onclick="approvePay('${pid}', '${pay.userId}', ${pay.amount})">APPROVE</button>
                                    <button class="btn-danger" onclick="rejectPay('${pid}')">REJECT</button>
                                ` : '-'}
                            </td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                });
                document.getElementById('pendingPayments').innerText = pendingCount;
            });
        }

        window.approvePay = async (pid, uid, amount) => {
            if(!confirm(`AUTHORIZE ₹${amount} for this user?`)) return;
            try {
                // 1. Mark Payment Success
                await updateDoc(doc(db, "payment_verifications", pid), { status: "Success" });
                
                // 2. Add Money to User Wallet AND Update Stats
                const userRef = doc(db, "users", uid);
                await updateDoc(userRef, { 
                    balance: increment(parseInt(amount)),
                    totalDeposited: increment(parseInt(amount)) // Optional Stat
                });
                alert("FUNDS TRANSFERRED SUCCESSFULLY.");
            } catch(e) { alert(e.message); }
        }

        window.rejectPay = async (pid) => {
            if(!confirm("REJECT this transaction?")) return;
            await updateDoc(doc(db, "payment_verifications", pid), { status: "Rejected" });
        }

        // Stats Placeholder
        window.loadStats = () => {
            // Real-time stats handled inside listeners above
        }

    </script>
</body>
</html>
