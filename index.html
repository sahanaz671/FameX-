<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FameX | Premium SMM</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* --- PREMIUM DARK THEME --- */
        :root {
            --bg-dark: #050505;
            --card-bg: rgba(20, 20, 20, 0.7);
            --accent: #7c4dff; 
            --accent-glow: rgba(124, 77, 255, 0.5);
            --gold: #ffd700;
            --text-main: #ffffff;
            --text-muted: #a0a0a0;
            --danger: #ff5252;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--bg-dark);
            background-image: radial-gradient(circle at 50% 0%, #1a0b2e 0%, #050505 60%);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        /* Navbar */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 5%;
            background: rgba(5, 5, 5, 0.8);
            backdrop-filter: blur(15px);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .logo { font-size: 1.8rem; font-weight: 800; letter-spacing: 2px; text-shadow: 0 0 15px var(--accent-glow); }
        .logo span { color: var(--accent); }

        .nav-actions { display: flex; gap: 15px; align-items: center; }

        .btn-menu {
            background: transparent;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            display: none; /* Hidden until login */
        }

        .btn-login {
            background: rgba(124, 77, 255, 0.1);
            border: 1px solid var(--accent);
            color: var(--accent);
            padding: 8px 25px;
            border-radius: 50px;
            cursor: pointer;
            transition: 0.4s;
            font-weight: 600;
        }
        .btn-login:hover { background: var(--accent); color: white; box-shadow: 0 0 20px var(--accent-glow); }

        /* Sidebar & Menu */
        .sidebar {
            position: fixed;
            top: 0; right: -320px;
            width: 280px;
            height: 100%;
            background: #0f0f0f;
            border-left: 1px solid #333;
            padding: 30px;
            transition: 0.4s;
            z-index: 200;
            box-shadow: -10px 0 30px rgba(0,0,0,0.8);
            overflow-y: auto;
        }
        .sidebar.active { right: 0; }

        .profile-header { text-align: center; margin-bottom: 30px; }
        .user-pic { width: 80px; height: 80px; border-radius: 50%; border: 2px solid var(--accent); margin-bottom: 10px; }
        .user-name { font-size: 1.2rem; font-weight: bold; }
        
        .balance-card {
            background: linear-gradient(45deg, #1a1a1a, #2a2a2a);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid var(--gold);
            margin-bottom: 25px;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.1);
        }
        .balance-label { font-size: 0.9rem; color: var(--text-muted); }
        .balance-amount { font-size: 2rem; color: var(--gold); font-weight: bold; margin: 5px 0; text-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }

        /* Menu Links */
        .menu-list { list-style: none; padding: 0; margin: 0; }
        .menu-item {
            display: flex; align-items: center; gap: 15px;
            padding: 15px;
            color: var(--text-muted);
            text-decoration: none;
            border-radius: 10px;
            transition: 0.3s;
            margin-bottom: 10px;
            cursor: pointer;
            font-size: 1rem;
        }
        .menu-item:hover { background: rgba(255,255,255,0.05); color: white; transform: translateX(5px); }
        .menu-item i { width: 20px; text-align: center; color: var(--accent); }
        
        .btn-logout {
            margin-top: 20px;
            width: 100%;
            padding: 12px;
            background: rgba(255, 82, 82, 0.1);
            color: var(--danger);
            border: 1px solid var(--danger);
            border-radius: 10px;
            cursor: pointer;
            transition: 0.3s;
            display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .btn-logout:hover { background: var(--danger); color: white; }

        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 150;
            display: none;
            backdrop-filter: blur(3px);
        }
        .overlay.active { display: block; }

        /* Hero */
        .hero { text-align: center; padding: 80px 20px 100px 20px; }
        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 15px;
            background: linear-gradient(to right, #fff, #b3b3b3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .hero p { color: var(--text-muted); font-size: 1.2rem; }

        /* --- NEW: PROMO BADGE STYLE --- */
        .promo-badge {
            display: inline-block;
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid var(--gold);
            color: var(--gold);
            padding: 8px 20px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 0.9rem;
            margin-bottom: 20px;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.4); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(255, 215, 0, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); }
        }

        /* Grid */
        .container { max-width: 1200px; margin: 0 auto; padding: 40px 20px; }
        .section { display: none; animation: fadeIn 0.5s; } /* Hide sections by default */
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .category-title {
            margin-top: 70px; margin-bottom: 25px;
            font-size: 1.6rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            border-left: 4px solid var(--accent);
            padding-left: 15px;
            text-shadow: 0 0 10px var(--accent-glow);
        }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; }

        /* Cards */
        .card {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: 0.4s;
            position: relative;
            backdrop-filter: blur(10px);
        }
        .card:hover {
            transform: translateY(-10px);
            border-color: var(--accent);
            box-shadow: 0 0 30px var(--accent-glow);
        }
        .card h3 { margin-top: 0; font-size: 1.3rem; }
        .card .price { font-size: 1.8rem; color: var(--accent); font-weight: 800; margin: 15px 0; text-shadow: 0 0 15px var(--accent-glow); }
        .card .desc { color: var(--text-muted); font-size: 0.95rem; margin-bottom: 25px; }

        .btn-buy {
            width: 100%;
            padding: 14px;
            background: linear-gradient(45deg, var(--accent), #5e35b1);
            border: none; color: white; border-radius: 12px;
            font-weight: bold; cursor: pointer; text-transform: uppercase;
            transition: 0.3s;
        }
        .btn-buy:hover { box-shadow: 0 0 25px var(--accent-glow); }

        /* Modals */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); justify-content: center; align-items: center; z-index: 1000;
            backdrop-filter: blur(5px);
        }
        .modal-content {
            background: #111; padding: 40px; border-radius: 20px; text-align: center;
            max-width: 400px; width: 90%; border: 1px solid var(--accent);
            box-shadow: 0 0 50px var(--accent-glow);
            position: relative;
        }
        .qr-code { width: 100%; max-width: 260px; border-radius: 15px; margin: 25px 0; border: 3px solid white; }
        
        .close-btn { background: #333; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; margin-top: 15px; }

        /* Helpers */
        .warning-box {
            background:rgba(255, 193, 7, 0.1); border:1px solid #ffc107; color:#ffc107; 
            padding:10px; border-radius:8px; font-size:0.85rem; margin-bottom:20px; text-align: left;
        }

        /* Footer */
        footer { background: rgba(10, 10, 10, 0.8); padding: 60px 20px; text-align: center; margin-top: 80px; border-top: 1px solid rgba(255, 255, 255, 0.05); }
        .social-links { display: flex; justify-content: center; gap: 25px; margin-bottom: 30px; }
        .social-btn {
            width: 55px; height: 55px; border-radius: 50%; background: rgba(255, 255, 255, 0.05);
            display: flex; align-items: center; justify-content: center; color: white;
            font-size: 1.6rem; text-decoration: none; transition: 0.4s; border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .social-btn:hover { transform: scale(1.1); border-color: var(--accent); background: var(--accent); box-shadow: 0 0 20px var(--accent-glow); }
        .whatsapp-float {
            position: fixed; bottom: 30px; right: 30px; background: #25d366; color: white;
            width: 65px; height: 65px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 2.2rem; box-shadow: 0 0 20px rgba(37, 211, 102, 0.5); z-index: 100; text-decoration: none; transition: 0.3s;
        }
        .whatsapp-float:hover { transform: scale(1.1); box-shadow: 0 0 30px rgba(37, 211, 102, 0.8); }

    </style>
</head>
<body>

    <header id="top">
        <div class="logo">Fame<span>X</span></div>
        <div class="nav-actions">
            <button class="btn-login" id="loginBtn">Login / Sign Up</button>
            <button class="btn-menu" id="menuBtn" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
        </div>
    </header>

    <div class="overlay" id="overlay" onclick="toggleSidebar()"></div>
    <div class="sidebar" id="sidebar">
        <div class="profile-header">
            <img src="https://via.placeholder.com/80" alt="User" class="user-pic" id="sideUserPic">
            <div class="user-name" id="sideUserName">Guest</div>
            <div style="font-size: 0.8rem; color: #888;" id="sideUserEmail">Not logged in</div>
        </div>
        
        <div class="balance-card">
            <div class="balance-label">Current Balance</div>
            <div class="balance-amount">â‚¹<span id="userBalance">0</span></div>
        </div>

        <div class="menu-list">
            <div class="menu-item" onclick="showSection('services-container')">
                <i class="fas fa-layer-group"></i> Services / New Order
            </div>
            <div class="menu-item" onclick="showSection('my-orders-section'); loadOrderHistory();">
                <i class="fas fa-list-ul"></i> My Orders
            </div>
            <div class="menu-item" onclick="openPaymentModal()">
                <i class="fas fa-wallet"></i> Add Funds
            </div>
            <div class="menu-item" onclick="openVerifyModal()">
                <i class="fas fa-file-invoice-dollar"></i> Verify Payment
            </div>
            <div class="menu-item" onclick="showSection('payment-history-section'); loadPaymentHistory();">
                <i class="fas fa-history"></i> Payment Status
            </div>
            <a href="#footer-support" class="menu-item" onclick="toggleSidebar()">
                <i class="fas fa-headset"></i> Help & Support
            </a>
        </div>

        <button class="btn-logout" id="logoutBtn">
            <i class="fas fa-sign-out-alt"></i> Log Out
        </button>

        <p style="color:#444; font-size:0.7rem; margin-top:30px; text-align:center;">
            v1.3.0 â€¢ Premium SMM
        </p>
    </div>

    <div class="hero">
        <div class="promo-badge">
            <i class="fas fa-bolt"></i> SPECIAL OFFER: 60% CASHBACK FOR NEW USERS!
        </div>
        
        <h1>Elevate Your Presence</h1>
        <p>Premium SMM Services. Instant Delivery. Dark Aesthetics.</p>
    </div>

    <div class="container section" id="services-container" style="display:grid;">
        </div>

    <div class="container section" id="my-orders-section">
        <h2 style="text-align:center; margin-bottom:30px; color:white;">My Orders</h2>
        <div style="overflow-x:auto;">
            <table style="width:100%; border-collapse:collapse; background:var(--card-bg); border-radius:10px;">
                <thead>
                    <tr style="border-bottom:1px solid #333; color:var(--accent);">
                        <th style="padding:15px; text-align:left;">ID</th>
                        <th style="padding:15px; text-align:left;">Service</th>
                        <th style="padding:15px; text-align:left;">Link</th>
                        <th style="padding:15px; text-align:center;">Charge</th>
                        <th style="padding:15px; text-align:center;">Status</th>
                    </tr>
                </thead>
                <tbody id="orders-table-body">
                </tbody>
            </table>
        </div>
    </div>

    <div class="container section" id="payment-history-section">
        <h2 style="text-align:center; margin-bottom:30px; color:white;">Payment Status</h2>
        <div style="overflow-x:auto;">
            <table style="width:100%; border-collapse:collapse; background:var(--card-bg); border-radius:10px;">
                <thead>
                    <tr style="border-bottom:1px solid #333; color:var(--accent);">
                        <th style="padding:15px; text-align:left;">Date</th>
                        <th style="padding:15px; text-align:left;">Amount</th>
                        <th style="padding:15px; text-align:left;">UTR / Sender</th>
                        <th style="padding:15px; text-align:center;">Status</th>
                    </tr>
                </thead>
                <tbody id="payment-table-body">
                    </tbody>
            </table>
        </div>
    </div>

    <div class="modal" id="paymentModal">
        <div class="modal-content">
            <h2>Add Funds</h2>
            <div class="warning-box">
                <i class="fas fa-exclamation-circle"></i> <strong>Rules:</strong><br>
                â€¢ Minimum Deposit: <strong>â‚¹500</strong><br>
                â€¢ <strong>PhonePe ONLY</strong>. No Paytm/GPay.<br>
                â€¢ Verification takes 2-4 hours.
            </div>
            <img src="https://imagefa.st/images/2025/12/25/PhonePeQR_India-Post-Payment-Bank---02681.png" alt="QR Code" class="qr-code">
            <p style="color: var(--text-muted); font-size: 0.9rem;">
                Scan & Pay. Then use the "Verify Payment" menu to submit your Transaction ID.
            </p>
            <button class="close-btn" onclick="closeModal()">Close</button>
        </div>
    </div>

    <div class="modal" id="verifyPaymentModal">
        <div class="modal-content" style="text-align:left; max-width:400px;">
            <h2 style="text-align:center;">Verify Payment</h2>
            
            <label style="color:var(--text-muted); font-size:0.9rem;">Amount Paid (â‚¹)</label>
            <input type="number" id="verifyAmount" placeholder="e.g. 500" style="width:100%; padding:10px; margin-bottom:15px; background:#222; border:1px solid #444; color:white; border-radius:5px;">

            <label style="color:var(--text-muted); font-size:0.9rem;">Sender Name</label>
            <input type="text" id="verifySender" placeholder="Name on PhonePe" style="width:100%; padding:10px; margin-bottom:15px; background:#222; border:1px solid #444; color:white; border-radius:5px;">

            <label style="color:var(--text-muted); font-size:0.9rem;">UTR / Transaction ID</label>
            <input type="text" id="verifyUTR" placeholder="T230..." style="width:100%; padding:10px; margin-bottom:15px; background:#222; border:1px solid #444; color:white; border-radius:5px;">

            <button id="btnSubmitVerify" class="btn-buy" onclick="submitPaymentVerification()">Submit for Verification</button>
            <button class="close-btn" onclick="closeVerifyModal()" style="width:100%; margin-top:10px; background:transparent; border:1px solid #444;">Cancel</button>
        </div>
    </div>

    <div class="modal" id="orderModal">
        <div class="modal-content" style="text-align:left; max-width:500px;">
            <h2 style="text-align:center; margin-top:0;">New Order</h2>
            
            <div class="warning-box">
                <i class="fas fa-exclamation-triangle"></i> <strong>Important:</strong><br>
                â€¢ Account must be <strong>Public</strong>.<br>
                â€¢ For Followers: Turn OFF "Flag for Review".
            </div>

            <label style="color:var(--text-muted); font-size:0.9rem;">Service</label>
            <input type="text" id="orderServiceName" readonly style="width:100%; padding:10px; margin-bottom:15px; background:#222; border:1px solid #444; color:white; border-radius:5px;">
            
            <label style="color:var(--text-muted); font-size:0.9rem;">Link (Instagram Post/Profile)</label>
            <input type="text" id="orderLink" placeholder="https://instagram.com/..." style="width:100%; padding:10px; margin-bottom:15px; background:#222; border:1px solid #444; color:white; border-radius:5px;">

            <label style="color:var(--text-muted); font-size:0.9rem;">Quantity (Min: 10)</label>
            <input type="number" id="orderQty" placeholder="100" oninput="calculatePrice()" style="width:100%; padding:10px; margin-bottom:15px; background:#222; border:1px solid #444; color:white; border-radius:5px;">

            <div style="text-align:right; margin-bottom:20px; font-size:1.1rem;">
                Total Charge: <span id="orderPrice" style="color:var(--accent); font-weight:bold;">â‚¹0</span>
            </div>

            <button id="btnConfirmOrder" class="btn-buy" onclick="submitOrder()">Place Order</button>
            <button class="close-btn" onclick="closeOrderModal()" style="width:100%; margin-top:10px; background:transparent; border:1px solid #444;">Cancel</button>
        </div>
    </div>

    <footer id="footer-support">
        <div class="social-links">
            <a href="https://t.me/therealghost_here" target="_blank" class="social-btn telegram"><i class="fab fa-telegram-plane"></i></a>
            <a href="https://www.instagram.com/lil.shiinee?igsh=MWpzMzdwazYxZ2hwNQ==" target="_blank" class="social-btn instagram"><i class="fab fa-instagram"></i></a>
        </div>
        <p style="color: var(--text-muted);">&copy; 2024 FameX. All rights reserved.</p>
    </footer>

    <a href="https://wa.me/918653340400" target="_blank" class="whatsapp-float"><i class="fab fa-whatsapp"></i></a>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, addDoc, collection, onSnapshot, query, where, orderBy } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAN_hd8rr46X25lOZ0cKwe6pAVl2sh61AI",
            authDomain: "famex-4cb1e.firebaseapp.com",
            projectId: "famex-4cb1e",
            storageBucket: "famex-4cb1e.firebasestorage.app",
            messagingSenderId: "395925089964",
            appId: "1:395925089964:web:551ef2089aa25d09743909",
            measurementId: "G-S1T0L618XL"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        let currentUser = null;
        let currentBalance = 0;
        let selectedServicePricePer1k = 0;

        const loginBtn = document.getElementById('loginBtn');
        const menuBtn = document.getElementById('menuBtn');
        const logoutBtn = document.getElementById('logoutBtn');

        // AUTH & DATABASE LISTENER
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                loginBtn.style.display = 'none';
                menuBtn.style.display = 'block';
                
                document.getElementById('sideUserName').innerText = user.displayName;
                document.getElementById('sideUserEmail').innerText = user.email;
                document.getElementById('sideUserPic').src = user.photoURL;

                const userRef = doc(db, "users", user.uid);
                
                // âš¡ REAL-TIME USER DATA & FORCE LOGOUT CHECK âš¡
                onSnapshot(userRef, (docSnap) => {
                    if (docSnap.exists()) {
                        const data = docSnap.data();

                        // 1. Check for Force Logout (Kick)
                        if (data.forceLogout) {
                            alert("You have been logged out by the Administrator.");
                            // Reset the flag and sign out
                            updateDoc(userRef, { forceLogout: false });
                            signOut(auth).then(() => window.location.reload());
                            return;
                        }

                        // 2. Update Balance
                        currentBalance = data.balance;
                        document.getElementById('userBalance').innerText = currentBalance;
                    } else {
                        // Create profile for new users
                        setDoc(userRef, { name: user.displayName, email: user.email, balance: 0 });
                    }
                });
            } else {
                currentUser = null;
                loginBtn.style.display = 'block';
                menuBtn.style.display = 'none';
                currentBalance = 0;
                showSection('services-container');
                document.getElementById('sidebar').classList.remove('active');
                document.getElementById('overlay').classList.remove('active');
            }
        });

        loginBtn.addEventListener('click', () => signInWithPopup(auth, provider).catch(console.error));
        logoutBtn.addEventListener('click', () => signOut(auth).then(()=>alert("Logged out")));

        // NAVIGATION
        window.toggleSidebar = () => {
            document.getElementById('sidebar').classList.toggle('active');
            document.getElementById('overlay').classList.toggle('active');
        }

        window.showSection = (sectionId) => {
            document.getElementById('services-container').style.display = 'none';
            document.getElementById('my-orders-section').style.display = 'none';
            document.getElementById('payment-history-section').style.display = 'none';
            
            const target = document.getElementById(sectionId);
            if(sectionId === 'services-container') target.style.display = 'grid';
            else target.style.display = 'block';
            
            toggleSidebar();
        }

        // --- NEW ORDER LOGIC ---
        window.openOrderForm = (serviceName, pricePer1k) => {
            if (!currentUser) return alert("Please Login first!");
            selectedServicePricePer1k = pricePer1k;
            document.getElementById('orderServiceName').value = serviceName;
            document.getElementById('orderPrice').innerText = "â‚¹0";
            document.getElementById('orderQty').value = "";
            document.getElementById('orderLink').value = "";
            document.getElementById('orderModal').style.display = 'flex';
        }

        window.calculatePrice = () => {
            const qty = document.getElementById('orderQty').value;
            if(qty > 0) {
                const total = (selectedServicePricePer1k * qty) / 1000;
                document.getElementById('orderPrice').innerText = "â‚¹" + total.toFixed(2);
            } else {
                document.getElementById('orderPrice').innerText = "â‚¹0";
            }
        }

        window.submitOrder = async () => {
            const qty = parseInt(document.getElementById('orderQty').value);
            const link = document.getElementById('orderLink').value;
            const serviceName = document.getElementById('orderServiceName').value;
            const totalCost = (selectedServicePricePer1k * qty) / 1000;

            if (!link) return alert("Please enter the link!");
            if (!qty || qty < 10) return alert("Minimum quantity is 10.");
            if (currentBalance < totalCost) return alert(`Insufficient Balance! You need â‚¹${totalCost.toFixed(2)}.`);

            if(!confirm(`Confirm Order?\nService: ${serviceName}\nQty: ${qty}\nCost: â‚¹${totalCost.toFixed(2)}`)) return;

            const btn = document.getElementById('btnConfirmOrder');
            btn.innerText = "Processing...";
            btn.disabled = true;
            
            try {
                const userRef = doc(db, "users", currentUser.uid);
                await updateDoc(userRef, { balance: currentBalance - totalCost });

                await addDoc(collection(db, "orders"), {
                    userId: currentUser.uid,
                    userName: currentUser.displayName,
                    userEmail: currentUser.email, // Save email for Admin
                    service: serviceName,
                    link: link,
                    quantity: qty,
                    cost: totalCost,
                    status: "Pending",
                    timestamp: new Date()
                });

                alert("Order Placed Successfully! ðŸš€");
                window.closeOrderModal();
            } catch (error) {
                console.error(error);
                alert("Order Failed: " + error.message);
            } finally {
                btn.innerText = "Place Order";
                btn.disabled = false;
            }
        }

        window.closeOrderModal = () => document.getElementById('orderModal').style.display = 'none';

        // --- REAL-TIME ORDER HISTORY (Sorting Removed) ---
        window.loadOrderHistory = () => {
            if(!currentUser) return;
            const tbody = document.getElementById('orders-table-body');
            tbody.innerHTML = "<tr><td colspan='5' style='text-align:center; padding:20px;'>Loading...</td></tr>";

            const q = query(collection(db, "orders"), where("userId", "==", currentUser.uid));
            
            onSnapshot(q, (snapshot) => {
                tbody.innerHTML = "";
                if(snapshot.empty) {
                    tbody.innerHTML = "<tr><td colspan='5' style='text-align:center; padding:20px; color:#888;'>No orders found.</td></tr>";
                    return;
                }
                
                snapshot.forEach(doc => {
                    const order = doc.data();
                    let statusColor = '#ffc107'; // Pending
                    if(order.status === 'Processing') statusColor = '#2196f3';
                    if(order.status === 'Completed') statusColor = '#00e676';
                    if(order.status === 'Cancelled') statusColor = '#ff5252';

                    const row = `
                        <tr style="border-bottom:1px solid #222;">
                            <td style="padding:15px; font-size:0.8rem; color:#666;">#${doc.id.substr(0,5)}</td>
                            <td style="padding:15px;">${order.service}<br><span style="font-size:0.8rem; color:#888;">Qty: ${order.quantity}</span></td>
                            <td style="padding:15px; font-size:0.8rem; color:var(--accent); max-width:150px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">
                                <a href="${order.link}" target="_blank" style="color:var(--accent); text-decoration:none;">Link ðŸ”—</a>
                            </td>
                            <td style="padding:15px; text-align:center;">â‚¹${order.cost.toFixed(2)}</td>
                            <td style="padding:15px; text-align:center;">
                                <span style="color:${statusColor}; font-weight:bold; font-size:0.85rem; border:1px solid ${statusColor}; padding:2px 8px; border-radius:4px;">
                                    ${order.status}
                                </span>
                            </td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                });
            });
        }

        // --- PAYMENT STATUS LOGIC ---
        window.loadPaymentHistory = () => {
            if(!currentUser) return;
            const tbody = document.getElementById('payment-table-body');
            tbody.innerHTML = "<tr><td colspan='4' style='text-align:center; padding:20px;'>Loading...</td></tr>";

            const q = query(collection(db, "payment_verifications"), where("userId", "==", currentUser.uid));
            
            onSnapshot(q, (snapshot) => {
                tbody.innerHTML = "";
                if(snapshot.empty) {
                    tbody.innerHTML = "<tr><td colspan='4' style='text-align:center; padding:20px; color:#888;'>No payment history found.</td></tr>";
                    return;
                }
                
                snapshot.forEach(doc => {
                    const payment = doc.data();
                    let statusColor = '#ffc107'; // Checking
                    if(payment.status === 'Success' || payment.status === 'Approved') statusColor = '#00e676';
                    if(payment.status === 'Rejected') statusColor = '#ff5252';
                    
                    const date = payment.timestamp ? new Date(payment.timestamp.seconds * 1000).toLocaleDateString() : 'N/A';

                    const row = `
                        <tr style="border-bottom:1px solid #222;">
                            <td style="padding:15px; font-size:0.8rem; color:#888;">${date}</td>
                            <td style="padding:15px; color:var(--gold);">â‚¹${payment.amount}</td>
                            <td style="padding:15px; font-size:0.8rem;">${payment.utr}<br><span style="color:#666;">${payment.senderName}</span></td>
                            <td style="padding:15px; text-align:center;">
                                <span style="color:${statusColor}; font-weight:bold; font-size:0.85rem; border:1px solid ${statusColor}; padding:2px 8px; border-radius:4px;">
                                    ${payment.status}
                                </span>
                            </td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                });
            });
        }

        // --- VERIFY PAYMENT LOGIC ---
        window.openPaymentModal = () => { document.getElementById('paymentModal').style.display = 'flex'; toggleSidebar(); }
        window.closeModal = () => { document.getElementById('paymentModal').style.display = 'none'; }
        
        window.openVerifyModal = () => { document.getElementById('verifyPaymentModal').style.display = 'flex'; toggleSidebar(); }
        window.closeVerifyModal = () => { document.getElementById('verifyPaymentModal').style.display = 'none'; }

        window.submitPaymentVerification = async () => {
            const amount = document.getElementById('verifyAmount').value;
            const sender = document.getElementById('verifySender').value;
            const utr = document.getElementById('verifyUTR').value;

            if(!amount || !sender || !utr) return alert("Please fill all fields.");

            const btn = document.getElementById('btnSubmitVerify');
            btn.innerText = "Submitting...";
            btn.disabled = true;

            try {
                // Save to NEW collection: 'payment_verifications'
                await addDoc(collection(db, "payment_verifications"), {
                    userId: currentUser.uid,
                    userName: currentUser.displayName,
                    userEmail: currentUser.email,
                    amount: amount,
                    senderName: sender,
                    utr: utr,
                    status: "Checking",
                    timestamp: new Date()
                });

                alert("Verification Submitted! Status: Checking.");
                window.closeVerifyModal();
            } catch (e) {
                console.error(e);
                alert("Error submitting: " + e.message);
            } finally {
                btn.innerText = "Submit for Verification";
                btn.disabled = false;
            }
        }

        // --- SERVICES ---
        const services = [
            {
                category: "Basic (Cheapest)",
                items: [
                    { name: "Flowers", price: 99, label: "â‚¹99 / 1k", desc: "Basic quality" },
                    { name: "Instagram Likes", price: 29, label: "â‚¹29 / 1k", desc: "Fast delivery" },
                    { name: "Views", price: 1, label: "â‚¹1 / 1k", desc: "High speed" },
                    { name: "Share", price: 3, label: "â‚¹3 / 1k", desc: "Boost reach" }
                ]
            },
            {
                category: "High Quality (Non-Drop)",
                items: [
                    { name: "Followers HQ", price: 249, label: "â‚¹249 / 1k", desc: "Stable non-drop" },
                    { name: "Likes HQ", price: 49, label: "â‚¹49 / 1k", desc: "Real profiles" },
                    { name: "Views HQ", price: 5, label: "â‚¹5 / 1k", desc: "Premium reach" },
                    { name: "Shares HQ", price: 15, label: "â‚¹15 / 1k", desc: "Viral boost" }
                ]
            },
            {
                category: "Premium (Verified + Real)",
                items: [
                    { name: "Followers Premium", price: 599, label: "â‚¹599 / 1k", desc: "Verified + Rich accounts" },
                    { name: "Likes Premium", price: 99, label: "â‚¹99 / 1k", desc: "Genuine interaction" },
                    { name: "Views Premium", price: 19, label: "â‚¹19 / 1k", desc: "High retention" },
                    { name: "Shares Premium", price: 49, label: "â‚¹49 / 1k", desc: "Executive tier" }
                ]
            },
            {
                category: "Comments",
                items: [
                    { name: "Normal Comments", price: 499, label: "â‚¹499 / 1k", desc: "Random positive text" },
                    { name: "Custom Text", price: 1499, label: "â‚¹1499 / 1k", desc: "You provide the text" }
                ]
            }
        ];

        const container = document.getElementById('services-container');
        services.forEach(cat => {
            const title = document.createElement('div');
            title.className = 'category-title';
            title.innerText = cat.category;
            container.appendChild(title);

            const grid = document.createElement('div');
            grid.className = 'grid';

            cat.items.forEach(item => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <h3>${item.name}</h3>
                    <div class="price">${item.label}</div>
                    <div class="desc">${item.desc}</div>
                    <button class="btn-buy" onclick="openOrderForm('${item.name}', ${item.price})">Purchase</button>
                `;
                grid.appendChild(card);
            });
            container.appendChild(grid);
        });
    </script>
</body>
</html>
